<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="./output.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@500;600;700&family=Sora:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="./theme.css" rel="stylesheet">
    <link rel="icon" type="image/svg-icon" href="./assest/feed.svg">
    <title>Feedback</title>
    <style>
        .star {
            transition: transform 150ms ease, color 150ms ease;
        }
        .star.is-active {
            color: #f59e0b;
            transform: scale(1.05);
        }
    </style>
</head>
<body class="page-shell theme-light motion-lite theme-rose min-h-screen bg-linear-to-br from-green-200 via-blue-300 to-green-300 text-slate-900">
    <header class="w-full">
        <nav class="mx-auto flex w-full max-w-5xl items-center justify-center px-4 py-6">
            <div class="flex flex-wrap items-center justify-center gap-2 rounded-2xl border border-white/30 bg-white/40 p-2 shadow-lg backdrop-blur-md">
                <a href="Home.html" class="rounded-xl px-4 py-2 text-sm font-semibold text-slate-700 transition hover:bg-white/70 hover:text-slate-900 focus:outline-none focus-visible:ring-2 focus-visible:ring-slate-400/60">Home</a>
                <a href="book Appoinment.html" class="rounded-xl px-4 py-2 text-sm font-semibold text-slate-700 transition hover:bg-white/70 hover:text-slate-900 focus:outline-none focus-visible:ring-2 focus-visible:ring-slate-400/60">Book Appointment</a>
                <a href="spare.html" class="rounded-xl px-4 py-2 text-sm font-semibold text-slate-700 transition hover:bg-white/70 hover:text-slate-900 focus:outline-none focus-visible:ring-2 focus-visible:ring-slate-400/60">Spare Parts</a>
                <a href="customer.html" class="rounded-xl px-4 py-2 text-sm font-semibold text-slate-700 transition hover:bg-white/70 hover:text-slate-900 focus:outline-none focus-visible:ring-2 focus-visible:ring-slate-400/60">Customer Details</a>
                <a href="feedback.html" class="rounded-xl bg-slate-900 px-4 py-2 text-sm font-semibold text-white shadow-md shadow-slate-900/20">Feedback</a>
                <a href="contact.html" class="rounded-xl px-4 py-2 text-sm font-semibold text-slate-700 transition hover:bg-white/70 hover:text-slate-900 focus:outline-none focus-visible:ring-2 focus-visible:ring-slate-400/60">Contact Us</a>
                <a href="Login.html" class="rounded-xl px-4 py-2 text-sm font-semibold text-slate-700 transition hover:bg-white/70 hover:text-slate-900 focus:outline-none focus-visible:ring-2 focus-visible:ring-slate-400/60">Log out</a>
            </div>
        </nav>
    </header>

    <main class="mx-auto flex w-full max-w-4xl flex-col items-center px-4 pb-16 pt-6">
        <section class="glass-card lift w-full rounded-3xl border border-white/20 bg-white/30 p-8 shadow-2xl backdrop-blur-md sm:p-10">
            <div class="text-center">
                <div class="title-row">
                    <span class="title-icon"><img src="./assest/feed.svg" alt="Feedback icon"></span>
                    <p class="text-sm font-semibold uppercase tracking-[0.35em] text-slate-700">Feedback</p>
                </div>
                <h1 class="display-title mt-2 text-3xl font-bold text-slate-900 sm:text-4xl">We Value Your Feedback</h1>
                <p class="mt-3 text-sm text-slate-600">Share your thoughts so we can improve your experience.</p>
            </div>

            <form id="feedback-form" class="mt-8 grid gap-6">
                <div>
                    <label for="customer-name" class="text-sm font-semibold text-slate-700">Customer Name</label>
                    <input id="customer-name" name="customer-name" type="text" placeholder="Enter your name" class="mt-2 w-full rounded-xl border border-white/40 bg-white/70 px-4 py-3 text-sm text-slate-900 shadow-sm outline-none transition focus:border-slate-300 focus:ring-2 focus:ring-slate-200" />
                </div>

                <div>
                    <p class="text-sm font-semibold text-slate-700">Star Rating</p>
                    <div id="star-rating" class="mt-2 flex items-center gap-2">
                        <button type="button" class="star text-2xl text-slate-400" data-value="1" aria-label="1 star">‚òÖ</button>
                        <button type="button" class="star text-2xl text-slate-400" data-value="2" aria-label="2 stars">‚òÖ</button>
                        <button type="button" class="star text-2xl text-slate-400" data-value="3" aria-label="3 stars">‚òÖ</button>
                        <button type="button" class="star text-2xl text-slate-400" data-value="4" aria-label="4 stars">‚òÖ</button>
                        <button type="button" class="star text-2xl text-slate-400" data-value="5" aria-label="5 stars">‚òÖ</button>
                    </div>
                    <input type="hidden" id="rating" name="rating" value="0" />
                </div>

                <div>
                    <label for="message" class="text-sm font-semibold text-slate-700">Message</label>
                    <textarea id="message" name="message" rows="5" placeholder="Enter your message" class="mt-2 w-full rounded-xl border border-white/40 bg-white/70 px-4 py-3 text-sm text-slate-900 shadow-sm outline-none transition focus:border-slate-300 focus:ring-2 focus:ring-slate-200"></textarea>
                </div>

                <p id="form-error" class="hidden rounded-xl border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-700"></p>

                <button type="submit" class="w-full rounded-xl bg-slate-900 px-6 py-3 text-sm font-semibold uppercase tracking-[0.2em] text-white shadow-lg transition hover:-translate-y-0.5 hover:bg-slate-800">
                    Send Feedback
                </button>
            </form>

            <div class="mt-10">
                <p class="text-sm font-semibold uppercase tracking-[0.35em] text-slate-700">Customer Feedback</p>
                <div id="feedback-list" class="mt-4 grid gap-4"></div>
                <p id="empty-feedback" class="mt-4 text-sm text-slate-600">No feedback yet.</p>
            </div>
        </section>
    </main>

    <footer class="mt-12 w-full border-t border-white/20 bg-white/20 backdrop-blur-md">
        <div class="mx-auto flex w-full max-w-5xl flex-col items-center justify-between gap-3 px-4 py-6 text-sm text-slate-700 sm:flex-row">
            <p class="font-semibold uppercase tracking-[0.2em] text-slate-800">AutoCare</p>
            <p>¬© 2026 AutoCare. All rights reserved.</p>
            <div class="flex items-center gap-4">
                <a href="Home.html" class="transition hover:text-slate-900">Home</a>
                <a href="contact.html" class="transition hover:text-slate-900">Contact</a>
                <a href="feedback.html" class="transition hover:text-slate-900">Feedback</a>
            </div>
        </div>
    </footer>

    <div id="success-overlay" class="fixed inset-0 z-50 hidden items-center justify-center bg-slate-900/60 px-4">
        <div class="relative w-full max-w-md rounded-3xl bg-white p-8 text-center shadow-2xl">
            <button id="close-overlay" type="button" class="absolute right-4 top-4 rounded-full p-2 text-lg font-semibold text-slate-500 transition hover:bg-slate-100 hover:text-slate-800" aria-label="Close">
                X
            </button>
            <div class="mx-auto flex h-20 w-20 items-center justify-center rounded-full bg-green-100">
                <svg class="h-12 w-12 text-green-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                    <path d="M20 6L9 17l-5-5"></path>
                </svg>
            </div>
            <h2 class="mt-4 text-2xl font-bold text-slate-900">üòçTHANK's FOR YOUR FEEDBACK...ü§ó</h2>
        </div>
    </div>

    <script>
        const form = document.getElementById("feedback-form");
        const nameInput = document.getElementById("customer-name");
        const messageInput = document.getElementById("message");
        const ratingInput = document.getElementById("rating");
        const stars = Array.from(document.querySelectorAll(".star"));
        const formError = document.getElementById("form-error");
        const feedbackList = document.getElementById("feedback-list");
        const emptyFeedback = document.getElementById("empty-feedback");
        const overlay = document.getElementById("success-overlay");
        const closeOverlay = document.getElementById("close-overlay");

        const renderStars = (value) => {
            stars.forEach((star) => {
                const active = Number(star.dataset.value) <= value;
                star.classList.toggle("is-active", active);
            });
        };

        stars.forEach((star) => {
            star.addEventListener("click", () => {
                const value = Number(star.dataset.value);
                ratingInput.value = String(value);
                renderStars(value);
            });
        });

        const API_BASE = (() => {
            if (window.location.protocol === "file:") return "http://localhost:3000";
            if (window.location.hostname === "localhost" && window.location.port && window.location.port !== "3000") {
                return "http://localhost:3000";
            }
            return "";
        })();

        const fetchFeedback = async () => {
            const response = await fetch(`${API_BASE}/api/feedback`);
            if (!response.ok) {
                throw new Error("Unable to load feedback.");
            }
            const data = await response.json();
            return Array.isArray(data.records) ? data.records : [];
        };

        const submitFeedback = async (payload) => {
            const response = await fetch(`${API_BASE}/api/feedback`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload)
            });
            if (!response.ok) {
                const data = await response.json().catch(() => ({}));
                throw new Error(data.message || "Unable to submit feedback.");
            }
            return response.json();
        };

        const renderFeedback = (records) => {
            feedbackList.textContent = "";
            if (records.length === 0) {
                emptyFeedback.classList.remove("hidden");
                return;
            }
            emptyFeedback.classList.add("hidden");
            records.forEach((record) => {
                const card = document.createElement("div");
                card.className = "glass-card lift rounded-2xl border border-white/30 bg-white/70 p-4 shadow-sm";
                card.innerHTML = `
                    <div class="flex items-center justify-between">
                        <p class="text-sm font-semibold text-slate-800">${record.name}</p>
                        <p class="text-sm text-amber-500">${"‚òÖ".repeat(record.rating)}</p>
                    </div>
                    <p class="mt-2 text-sm text-slate-600">${record.message}</p>
                `;
                feedbackList.appendChild(card);
            });
        };

        const showError = (message) => {
            formError.textContent = message;
            formError.classList.remove("hidden");
        };

        const clearError = () => {
            formError.textContent = "";
            formError.classList.add("hidden");
        };

        const openOverlay = () => {
            overlay.classList.remove("hidden");
            overlay.classList.add("flex");
        };

        const resetForm = () => {
            form.reset();
            ratingInput.value = "0";
            renderStars(0);
            clearError();
        };

        const closeAndReset = () => {
            overlay.classList.add("hidden");
            overlay.classList.remove("flex");
            resetForm();
        };

        const loadFeedback = async () => {
            try {
                const records = await fetchFeedback();
                renderFeedback(records);
            } catch (err) {
                emptyFeedback.classList.remove("hidden");
            }
        };

        form.addEventListener("submit", async (event) => {
            event.preventDefault();
            clearError();

            const nameValue = nameInput.value.trim();
            const messageValue = messageInput.value.trim();
            const ratingValue = Number(ratingInput.value);

            if (!nameValue || !messageValue || ratingValue === 0) {
                showError("Please enter your name, message, and select a star rating.");
                return;
            }

            try {
                await submitFeedback({ name: nameValue, message: messageValue, rating: ratingValue });
                await loadFeedback();
                openOverlay();
                resetForm();
            } catch (err) {
                showError(err.message);
            }
        });

        closeOverlay.addEventListener("click", closeAndReset);

        loadFeedback();
    </script>
</body>
</html>
